<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Louisiana Burn Ban Checker</title>
<style>
  body { font-family: Arial, sans-serif; padding: 2rem; }
  button { padding: 0.5rem 1rem; font-size: 1rem; }
  ul { margin-top: 1rem; }
</style>
</head>
<body>

<h1>Louisiana Burn Ban Checker</h1>
<p>Click the button to see which parishes currently have a burn ban:</p>
<button id="checkButton">Check Active Bans</button>
<ul id="results"></ul>

<script>
const WEBMAP_JSON_URL = 'https://louisiana.maps.arcgis.com/sharing/rest/content/items/363fa05d91ee4d7d903c7167445a2/data?f=json';
const resultsList = document.getElementById('results');
const button = document.getElementById('checkButton');

button.addEventListener('click', async () => {
  resultsList.innerHTML = '<li>Loading...</li>';
  try {
    const response = await fetch(WEBMAP_JSON_URL);
    const data = await response.json();

    // Look for the layer with Burn_Ban1 field
    const burnLayer = data.layers.find(layer => 
      layer.popupInfo?.fieldInfos?.some(f => f.fieldName === 'Burn_Ban1')
    );

    if (!burnLayer) {
      resultsList.innerHTML = '<li>Could not find burn ban layer.</li>';
      return;
    }

    // FeatureCollection may be nested in layerDefinition.featureSet.features
    const features = burnLayer.featureCollection?.layers?.[0]?.featureSet?.features || [];

    const activeParishes = features
      .map(f => f.attributes)
      .filter(attr => attr.Burn_Ban1 === 'Burn Ban')
      .map(attr => attr.Parish1);

    if (activeParishes.length === 0) {
      resultsList.innerHTML = '<li>No active burn bans.</li>';
      return;
    }

    resultsList.innerHTML = '';
    activeParishes.forEach(parish => {
      const li = document.createElement('li');
      li.textContent = parish;
      resultsList.appendChild(li);
    });

  } catch (err) {
    resultsList.innerHTML = `<li>Error fetching data: ${err.message}</li>`;
    console.error(err);
  }
});
</script>

</body>
</html>
